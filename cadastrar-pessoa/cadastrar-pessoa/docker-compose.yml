version: '3'
name: cadastrarpessoa
services:
  postgres:
    image: postgres:latest
    container_name: postgres
    restart: always
    environment:
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=postgres
      - POSTGRES_DB=people
    ports:
      - "5432:5432"
    networks:
      - cadastrarpessoa-net

  zookeeper:
    image: confluentinc/cp-zookeeper:latest
    container_name: zookeeper
    environment:
      ZOOKEEPER_CLIENT_PORT: 2181
      ZOOKEEPER_TICK_TIME: 2000
    networks:
      - cadastrarpessoa-net

  kafka:
    image: bitnami/kafka:latest
    container_name: kafka
    depends_on:
      - zookeeper
    environment:
      KAFKA_BROKER_ID: 1
      KAFKA_ZOOKEEPER_CONNECT: "zookeeper:2181"
      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://localhost:9092,INTERNAL://kafka:19092
      KAFKA_LISTENERS: PLAINTEXT://0.0.0.0:9092,INTERNAL://0.0.0.0:19092
      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: PLAINTEXT:PLAINTEXT,INTERNAL:PLAINTEXT
      KAFKA_INTER_BROKER_LISTENER_NAME: INTERNAL
      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1
      KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS: 0
    ports:
      - "9092:9092"
    networks:
      - cadastrarpessoa-net

networks:
  cadastrarpessoa-net:
    driver: bridge


#  zookeeper:
#    image: confluentinc/cp-zookeeper:latest
#    environment:
#      ZOOKEEPER_CLIENT_PORT: 32181
#      ZOOKEEPER_TICK_TIME: 2000
#    extra_hosts:
#      - "moby:127.0.0.1"
#
#  kafka:
#    image: confluentinc/cp-kafka:latest
#    depends_on:
#      - zookeeper
#    environment:
#      KAFKA_BROKER_ID: 1
#      KAFKA_ZOOKEEPER_CONNECT: localhost:32181
#      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://localhost:29092
#      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1
#    volumes:
#      - custom-hosts:/path/to/mount
#
#volumes:
#  custom-hosts:
#    driver: local
#    driver_opts:
#      type: none
#      device: ./custom-hosts
#      o: bind
#
#
#
#  #  volumes:
##    custom-hosts:
##      driver: local
##      driver_opts:
##        type: none
##        device: ./custom-hosts
##        o: bind
#
#
#  #  jaeger:
#  #    image: jaegertracing/all-in-one
#  #    ports:
#  #      - 5775:5775/udp
#  #      - 6831:6831/udp
#  #      - 6832:6832/udp
#  #      - 5778:5778
#  #      - 16686:16686
#  #      - 14268:14268
#  #      - 14250:14250
#  #      - 9411:9411
#  #    environment:
#  #      COLLECTOR_ZIPKIN_HTTP_PORT: 9411
#  #
#  #  contas:
#  #    image: 'zupacademy/contas'
#  #    ports:
#  #      - 8888:8888
#  #    environment:
#  #      SERVER_PORT: 8888
#  #      LOG_LEVEL: INFO
#  #      JAEGER_ENDPOINT: http://jaeger:14268/api/traces
#  #
#  #  analise:
#  #    image: 'zupacademy/analise-financeira'
#  #    ports:
#  #      - 9999:9999
#  #    #      - 9998:9999
#  #    environment:
#  #      SERVER_PORT: 9999
#  #      LOG_LEVEL: INFO
#  #      URL_SISTEMA_CARTAO: http://contas:8888/api/cartoes
#  #      JAEGER_ENDPOINT: http://jaeger:14268/api/traces
#
